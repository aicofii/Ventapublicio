<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ä¼šå‘˜ç®¡ç† - è¶…å¸‚</title>
  <!-- Load Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Load React and ReactDOM -->
  <script src="https://cdn.jsdelivr.net/npm/react@18.3.1/umd/react.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18.3.1/umd/react-dom.production.min.js"></script>
  <!-- Load Babel for JSX transformation -->
  <script src="https://cdn.jsdelivr.net/npm/@babel/standalone@7.25.6/babel.min.js"></script>
  <!-- CDN Fallback Check -->
  <script>
    window.addEventListener('load', () => {
      if (!window.React || !window.ReactDOM || !window.Babel) {
        document.getElementById('error-message').classList.remove('hidden');
        document.getElementById('error-message').innerText = 
          'é”™è¯¯ï¼šæ— æ³•åŠ è½½å¿…è¦èµ„æºã€‚è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–å°è¯•ä½¿ç”¨å…¶ä»–æµè§ˆå™¨ï¼ˆå¦‚ Chromeã€Firefoxï¼‰ã€‚';
      }
    });
  </script>
</head>
<body class="bg-gray-100 font-sans">
  <!-- Fallback message if JavaScript fails -->
  <div id="error-message" className="hidden text-center p-4 text-red-600">
    é”™è¯¯ï¼šæ— æ³•åŠ è½½åº”ç”¨ç¨‹åºã€‚è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥å¹¶åˆ·æ–°é¡µé¢ã€‚
  </div>
  <!-- Root element for React -->
  <div id="root"></div>

  <script type="text/babel">
    // Modal Component for Creating Customer
    function CreateCustomerModal({ isOpen, onClose, onSave }) {
      const [formData, setFormData] = React.useState({
        id: '',
        name: '',
        taxNumber: '',
        address: '',
        phone: ''
      });

      const handleChange = (e) => {
        const { name, value } = e.target;
        setFormData((prev) => ({ ...prev, [name]: value }));
      };

      const handleSubmit = () => {
        if (!formData.id || !formData.name || !formData.phone) {
          alert('å®¢æˆ·ä»£ç ã€å®¢æˆ·åç§°å’Œç”µè¯ä¸ºå¿…å¡«é¡¹ï¼');
          return;
        }
        onSave(formData);
        setFormData({ id: '', name: '', taxNumber: '', address: '', phone: '' });
        onClose();
      };

      if (!isOpen) return null;

      return (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
          <div className="bg-white p-6 rounded-lg shadow-lg w-full max-w-md">
            <h3 className="text-lg font-bold mb-4">åˆ›å»ºå®¢æˆ·</h3>
            <div className="space-y-4">
              <div>
                <label className="block text-sm font-medium text-gray-700">å®¢æˆ·ä»£ç </label>
                <input
                  type="text"
                  name="id"
                  value={formData.id}
                  onChange={handleChange}
                  className="mt-1 p-2 w-full border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                  placeholder="è¯·è¾“å…¥å®¢æˆ·ä»£ç "
                  required
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700">å®¢æˆ·åç§°</label>
                <input
                  type="text"
                  name="name"
                  value={formData.name}
                  onChange={handleChange}
                  className="mt-1 p-2 w-full border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                  placeholder="è¯·è¾“å…¥å®¢æˆ·åç§°"
                  required
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700">å®¢æˆ·ç¨å·</label>
                <input
                  type="text"
                  name="taxNumber"
                  value={formData.taxNumber}
                  onChange={handleChange}
                  className="mt-1 p-2 w-full border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                  placeholder="è¯·è¾“å…¥å®¢æˆ·ç¨å·"
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700">å®¢æˆ·åœ°å€</label>
                <input
                  type="text"
                  name="address"
                  value={formData.address}
                  onChange={handleChange}
                  className="mt-1 p-2 w-full border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                  placeholder="è¯·è¾“å…¥å®¢æˆ·åœ°å€"
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700">å®¢æˆ·ç”µè¯</label>
                <input
                  type="text"
                  name="phone"
                  value={formData.phone}
                  onChange={handleChange}
                  className="mt-1 p-2 w-full border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                  placeholder="è¯·è¾“å…¥å®¢æˆ·ç”µè¯"
                  required
                />
              </div>
            </div>
            <div className="mt-6 flex justify-end space-x-2">
              <button
                onClick={onClose}
                className="bg-gray-300 text-gray-700 px-4 py-2 rounded hover:bg-gray-400"
              >
                å–æ¶ˆ
              </button>
              <button
                onClick={handleSubmit}
                className="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700"
              >
                ä¿å­˜
              </button>
            </div>
          </div>
        </div>
      );
    }

    // Error Boundary Component
    class ErrorBoundary extends React.Component {
      state = { hasError: false, errorMessage: '' };
      static getDerivedStateFromError(error) {
        return { hasError: true, errorMessage: error.message };
      }
      render() {
        if (this.state.hasError) {
          return (
            <div className="text-red-600 p-4 text-center">
              æ¸²æŸ“åº”ç”¨ç¨‹åºæ—¶å‡ºé”™ï¼š{this.state.errorMessage}ã€‚è¯·æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°æˆ–è”ç³»æ”¯æŒã€‚
            </div>
          );
        }
        return this.props.children;
      }
    }

    // Main Customer Component
    function CustomerList() {
      // Initialize customers from localStorage or empty array
      const [customers, setCustomers] = React.useState(() => {
        const savedCustomers = localStorage.getItem('customers');
        return savedCustomers ? JSON.parse(savedCustomers) : [];
      });
      const [isModalOpen, setIsModalOpen] = React.useState(false);

      // Save customers to localStorage whenever customers state changes
      React.useEffect(() => {
        localStorage.setItem('customers', JSON.stringify(customers));
      }, [customers]);

      const handleCreateCustomer = () => {
        setIsModalOpen(true);
      };

      const handleSaveCustomer = (newCustomer) => {
        setCustomers((prev) => [...prev, newCustomer]);
      };

      const handleCloseModal = () => {
        setIsModalOpen(false);
      };

      return (
        <div className="flex h-screen">
          {/* Sidebar (consistent with index.html) */}
          <div className="w-16 bg-gray-900 text-white flex flex-col items-center py-4 fixed h-full shadow-lg">
            <h1 className="text-lg font-bold mb-8">POS</h1>
            <nav className="flex flex-col space-y-4">
              <a href="index.html" className="p-2 rounded-full hover:bg-gray-700" title="é”€å”®">
                ğŸ›’
              </a>
              <button className="p-2 rounded-full hover:bg-gray-700" title="åº“å­˜">
                ğŸ“¦
              </button>
              <button className="p-2 rounded-full bg-blue-600" title="ä¼šå‘˜">
                ğŸ‘¤
              </button>
              <button className="p-2 rounded-full hover:bg-gray-700" title="æ”¯ä»˜">
                ğŸ’³
              </button>
              <button className="p-2 rounded-full hover:bg-gray-700" title="æŠ¥å‘Š">
                ğŸ“Š
              </button>
              <button className="p-2 rounded-full hover:bg-gray-700" title="ç”¨æˆ·">
                ğŸ”’
              </button>
              <a href="tickets.html" className="p-2 rounded-full hover:bg-gray-700" title="ç¥¨æ®">
                ğŸ«
              </a>
              <a href="deuda.html" className="p-2 rounded-full hover:bg-gray-700" title="æŒ‚å•">
                ğŸ“‹
              </a>
            </nav>
          </div>
          {/* Main Content */}
          <div className="ml-16 w-full bg-white p-6">
            <h2 className="text-xl font-bold mb-4">ä¼šå‘˜ç®¡ç†</h2>
            {/* Create Customer Button */}
            <div className="mb-6">
              <button
                onClick={handleCreateCustomer}
                className="bg-blue-600 text-white p-3 rounded text-lg hover:bg-blue-700"
              >
                åˆ›å»ºå®¢æˆ·
              </button>
            </div>
            {/* Customer List */}
            <div className="bg-gray-50 p-4 rounded-lg shadow">
              {customers.length === 0 ? (
                <p className="text-gray-500">æš‚æ— å®¢æˆ·æ•°æ®ã€‚</p>
              ) : (
                <table className="w-full border-collapse">
                  <thead>
                    <tr className="bg-gray-200">
                      <th className="border p-3 text-left">å®¢æˆ·ä»£ç </th>
                      <th className="border p-3 text-left">å®¢æˆ·åç§°</th>
                      <th className="border p-3 text-left">å®¢æˆ·ç¨å·</th>
                      <th className="border p-3 text-left">å®¢æˆ·åœ°å€</th>
                      <th className="border p-3 text-left">å®¢æˆ·ç”µè¯</th>
                      <th className="border p-3 text-left">æ“ä½œ</th>
                    </tr>
                  </thead>
                  <tbody>
                    {customers.map((customer) => (
                      <tr key={customer.id}>
                        <td className="border p-3">{customer.id}</td>
                        <td className="border p-3">{customer.name}</td>
                        <td className="border p-3">{customer.taxNumber || '-'}</td>
                        <td className="border p-3">{customer.address || '-'}</td>
                        <td className="border p-3">{customer.phone}</td>
                        <td className="border p-3">
                          <button
                            className="bg-blue-500 text-white px-3 py-1 rounded mr-2 hover:bg-blue-600"
                            onClick={() => alert(`ç¼–è¾‘å®¢æˆ· ${customer.name} åŠŸèƒ½å¾…å®ç°ï¼`)}
                          >
                            ç¼–è¾‘
                          </button>
                          <button
                            className="bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600"
                            onClick={() => alert(`åˆ é™¤å®¢æˆ· ${customer.name} åŠŸèƒ½å¾…å®ç°ï¼`)}
                          >
                            åˆ é™¤
                          </button>
                        </td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              )}
            </div>
            {/* Modal for Creating Customer */}
            <CreateCustomerModal
              isOpen={isModalOpen}
              onClose={handleCloseModal}
              onSave={handleSaveCustomer}
            />
          </div>
        </div>
      );
    }

    // Render the app using createRoot
    const rootElement = document.getElementById("root");
    const root = ReactDOM.createRoot(rootElement);
    root.render(
      <ErrorBoundary>
        <CustomerList />
      </ErrorBoundary>
    );
  </script>
</body>
</html>