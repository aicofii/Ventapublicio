<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>记账列表 - 超市</title>
  <!-- Load Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Load React and ReactDOM -->
  <script src="https://cdn.jsdelivr.net/npm/react@18.3.1/umd/react.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18.3.1/umd/react-dom.production.min.js"></script>
  <!-- Load Babel for JSX transformation -->
  <script src="https://cdn.jsdelivr.net/npm/@babel/standalone@7.25.6/babel.min.js"></script>
  <!-- CDN Fallback Check -->
  <script>
    window.addEventListener('load', () => {
      if (!window.React || !window.ReactDOM || !window.Babel) {
        document.getElementById('error-message').classList.remove('hidden');
        document.getElementById('error-message').innerText = 
          localStorage.getItem('language') === 'es' 
            ? 'Error: No se pudieron cargar los recursos necesarios. Verifica tu conexión a internet o intenta con otro navegador (como Chrome o Firefox).'
            : '错误：无法加载必要资源。请检查网络连接或尝试使用其他浏览器（如 Chrome、Firefox）。';
      }
    });
  </script>
</head>
<body class="bg-gray-100 font-sans">
  <!-- Fallback message if JavaScript fails -->
  <div id="error-message" class="hidden text-center p-4 text-red-600"></div>
  <!-- Root element for React -->
  <div id="root"></div>

  <script type="text/babel">
    // Translations object
    const translations = {
      zh: {
        title: "记账列表 - 超市",
        pos: "POS",
        sales: "销售",
        inventory: "库存",
        membership: "会员",
        payments: "支付",
        reports: "报告",
        users: "用户",
        tickets: "票据",
        debt: "记账",
        debtList: "记账列表",
        search: "查询",
        noDebts: "没有符合条件的记账记录。",
        select: "选择",
        customerName: "客户名称",
        phone: "电话",
        taxId: "税号",
        date: "日期",
        amount: "金额",
        actions: "操作",
        details: "详情",
        settle: "结账",
        batchSettle: "批量结账",
        cancelBatch: "取消批量结账",
        confirm: "确定",
        debtDetails: "记账详情",
        cartDetails: "购物车明细",
        product: "产品",
        unitPrice: "单价",
        quantity: "数量",
        total: "总计",
        discount: "折扣",
        close: "关闭",
        selectPayment: "选择支付方式",
        card: "刷卡",
        cash: "现金",
        totalAmount: "总金额",
        amountDue: "应付金额",
        receivedAmount: "实收金额",
        change: "找零",
        cancel: "取消",
        searchDebt: "查询记账记录",
        searchCustomerPlaceholder: "输入客户名称",
        searchDatePlaceholder: "选择日期",
        searchAmountPlaceholder: "输入金额",
        errorInsufficientCash: "实收金额不足以支付应付金额！",
        errorNoSelection: "请至少选择一项进行结账！",
        selectLanguage: "选择语言",
        spanish: "西班牙语",
        chinese: "中文",
        errorRender: "渲染应用程序时出错：{error}。请查看浏览器控制台或联系支持。"
      },
      es: {
        title: "Lista de Deudas - Supermercado",
        pos: "POS",
        sales: "Ventas",
        inventory: "Inventario",
        membership: "Membresía",
        payments: "Pagos",
        reports: "Informes",
        users: "Usuarios",
        tickets: "Tickets",
        debt: "Deuda",
        debtList: "Lista de Deudas",
        search: "Buscar",
        noDebts: "No se encontraron registros de deudas que coincidan.",
        select: "Seleccionar",
        customerName: "Nombre del Cliente",
        phone: "Teléfono",
        taxId: "Número de Identificación Fiscal",
        date: "Fecha",
        amount: "Monto",
        actions: "Acciones",
        details: "Detalles",
        settle: "Liquidar",
        batchSettle: "Liquidación Masiva",
        cancelBatch: "Cancelar Liquidación Masiva",
        confirm: "Confirmar",
        debtDetails: "Detalles de la Deuda",
        cartDetails: "Detalles del Carrito",
        product: "Producto",
        unitPrice: "Precio Unitario",
        quantity: "Cantidad",
        total: "Total",
        discount: "Descuento",
        close: "Cerrar",
        selectPayment: "Seleccionar Método de Pago",
        card: "Tarjeta",
        cash: "Efectivo",
        totalAmount: "Monto Total",
        amountDue: "Monto a Pagar",
        receivedAmount: "Monto Recibido",
        change: "Cambio",
        cancel: "Cancelar",
        searchDebt: "Buscar Registros de Deuda",
        searchCustomerPlaceholder: "Ingresa el nombre del cliente",
        searchDatePlaceholder: "Selecciona la fecha",
        searchAmountPlaceholder: "Ingresa el monto",
        errorInsufficientCash: "¡El monto recibido no es suficiente para cubrir el monto a pagar!",
        errorNoSelection: "¡Por favor, selecciona al menos un elemento para liquidar!",
        selectLanguage: "Seleccionar Idioma",
        spanish: "Español",
        chinese: "Chino",
        errorRender: "Error al renderizar la aplicación: {error}. Consulta la consola del navegador o contacta al soporte."
      }
    };

    // Error Boundary Component
    class ErrorBoundary extends React.Component {
      state = { hasError: false, errorMessage: '' };
      static getDerivedStateFromError(error) {
        return { hasError: true, errorMessage: error.message };
      }
      render() {
        if (this.state.hasError) {
          return (
            <div className="text-red-600 p-4 text-center">
              {this.props.t.errorRender.replace('{error}', this.state.errorMessage)}
            </div>
          );
        }
        return this.props.children;
      }
    }

    // Debt Details Modal Component
    function DebtDetailsModal({ isOpen, onClose, transaction, t }) {
      if (!isOpen || !transaction) return null;

      return (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
          <div className="bg-white rounded-lg p-6 w-1/2">
            <h2 className="text-xl font-bold mb-4">{t.debtDetails}</h2>
            <p><strong>{t.customerName}:</strong> {transaction.customerName}</p>
            <p><strong>{t.phone}:</strong> {transaction.customerPhone}</p>
            <p><strong>{t.taxId}:</strong> {transaction.customerTaxNumber || t.defaultTaxId}</p>
            <p><strong>{t.date}:</strong> {transaction.timestamp}</p>
            <p><strong>{t.total}:</strong> €{transaction.total.toFixed(2)}</p>
            <p><strong>{t.discount}:</strong> {transaction.discount}%</p>
            <h3 className="text-lg font-semibold mt-4">{t.cartDetails}</h3>
            <table className="w-full border-collapse mt-2">
              <thead>
                <tr className="bg-gray-200">
                  <th className="border p-2 text-left">{t.product}</th>
                  <th className="border p-2 text-left">{t.unitPrice}</th>
                  <th className="border p-2 text-left">{t.quantity}</th>
                  <th className="border p-2 text-left">{t.total}</th>
                </tr>
              </thead>
              <tbody>
                {transaction.cart.map((item, index) => (
                  <tr key={index}>
                    <td className="border p-2">{t.lang === 'es' ? item.name_es || item.name : item.name}</td>
                    <td className="border p-2">€{item.price.toFixed(2)}</td>
                    <td className="border p-2">{item.quantity}</td>
                    <td className="border p-2">€{(item.price * item.quantity).toFixed(2)}</td>
                  </tr>
                ))}
              </tbody>
            </table>
            <button
              onClick={onClose}
              className="mt-4 bg-gray-500 text-white p-2 rounded w-full hover:bg-gray-600"
            >
              {t.close}
            </button>
          </div>
        </div>
      );
    }

    // Cash Payment Modal Component
    function CashPaymentModal({ isOpen, onClose, onConfirm, transaction, selectedTransactions, t }) {
      const [receivedAmount, setReceivedAmount] = React.useState("");

      // Calculate total amount due
      const amountDue = transaction ? transaction.total.toFixed(2) : "0.00";
      
      // Calculate change
      const change = (parseFloat(receivedAmount) - parseFloat(amountDue)).toFixed(2);

      // Handle number button clicks
      const handleNumberClick = (number) => {
        setReceivedAmount((prev) => prev + number);
      };

      // Handle delete button
      const handleDelete = () => {
        setReceivedAmount((prev) => prev.slice(0, -1));
      };

      // Handle confirm payment
      const handleConfirmPayment = () => {
        if (!receivedAmount || parseFloat(receivedAmount) < parseFloat(amountDue)) {
          alert(t.errorInsufficientCash);
          return;
        }

        // Generate tickets based on selectedTransactions or single transaction
        const tickets = selectedTransactions
          ? selectedTransactions.map(tx => ({
              id: tx.id,
              timestamp: new Date().toLocaleString(t.lang === 'es' ? "es-ES" : "zh-CN"),
              total: tx.total,
              items: tx.cart.map(item => ({ 
                name: t.lang === 'es' ? item.name_es || item.name : item.name, 
                quantity: item.quantity, 
                price: item.price 
              })),
              discount: tx.discount,
              paymentMethod: "cash",
              receivedAmount: parseFloat(receivedAmount) / selectedTransactions.length,
              change: parseFloat(change) >= 0 ? parseFloat(change) / selectedTransactions.length : 0,
              customerName: tx.customerName,
              customerPhone: tx.customerPhone,
              customerTaxNumber: tx.customerTaxNumber || ''
            }))
          : [{
              id: transaction.id,
              timestamp: new Date().toLocaleString(t.lang === 'es' ? "es-ES" : "zh-CN"),
              total: parseFloat(amountDue),
              items: transaction.cart.map(item => ({ 
                name: t.lang === 'es' ? item.name_es || item.name : item.name, 
                quantity: item.quantity, 
                price: item.price 
              })),
              discount: transaction.discount,
              paymentMethod: "cash",
              receivedAmount: parseFloat(receivedAmount),
              change: parseFloat(change) >= 0 ? parseFloat(change) : 0,
              customerName: transaction.customerName,
              customerPhone: transaction.customerPhone,
              customerTaxNumber: transaction.customerTaxNumber || ''
            }];

        // Save tickets to localStorage for tickets.html
        const savedTickets = JSON.parse(localStorage.getItem("tickets") || "[]");
        localStorage.setItem("tickets", JSON.stringify([...savedTickets, ...tickets]));
        onConfirm("cash", tickets);
        setReceivedAmount("");
        onClose();
      };

      if (!isOpen) return null;

      return (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
          <div className="bg-white rounded-lg p-6 w-1/2 flex">
            {/* Left Panel: Amounts */}
            <div className="w-1/2 pr-4 flex flex-col space-y-4">
              <div>
                <label className="block text-lg font-medium text-gray-700">{t.amountDue}</label>
                <p className="text-2xl font-bold">€{amountDue}</p>
              </div>
              <div>
                <label className="block text-lg font-medium text-gray-700">{t.receivedAmount}</label>
                <p className="text-2xl font-bold">€{receivedAmount || "0.00"}</p>
              </div>
              <div>
                <label className="block text-lg font-medium text-gray-700">{t.change}</label>
                <p className="text-2xl font-bold">€{receivedAmount ? (change >= 0 ? change : "0.00") : "0.00"}</p>
              </div>
              <div className="flex space-x-2">
                <button
                  onClick={onClose}
                  className="bg-gray-500 text-white px-4 py-2 rounded w-full hover:bg-gray-600"
                >
                  {t.cancel}
                </button>
                <button
                  onClick={handleConfirmPayment}
                  className="bg-green-600 text-white px-4 py-2 rounded w-full hover:bg-green-700"
                >
                  {t.confirm}
                </button>
              </div>
            </div>
            {/* Right Panel: Number Pad */}
            <div className="w-1/2 grid grid-cols-3 gap-2">
              {['1', '2', '3', '4', '5', '6', '7', '8', '9', '0'].map((number) => (
                <button
                  key={number}
                  onClick={() => handleNumberClick(number)}
                  className="bg-gray-200 p-4 rounded text-lg hover:bg-gray-300"
                >
                  {number}
                </button>
              ))}
              <button
                onClick={handleDelete}
                className="bg-red-500 text-white p-4 rounded text-lg hover:bg-red-600"
              >
                ←
              </button>
            </div>
          </div>
        </div>
      );
    }

    // Payment Modal Component for Settling Debt
    function SettlePaymentModal({ isOpen, onClose, onConfirm, transaction, selectedTransactions, t }) {
      const [isCashModalOpen, setIsCashModalOpen] = React.useState(false);

      // Calculate total for multiple transactions if provided
      const totalAmount = selectedTransactions
        ? selectedTransactions.reduce((sum, tx) => sum + tx.total, 0)
        : transaction?.total || 0;

      const handlePayment = (method) => {
        if (method === "cash") {
          setIsCashModalOpen(true);
          return;
        }
        // Generate tickets for card payment
        const tickets = (selectedTransactions || [transaction]).map(tx => ({
          id: tx.id,
          timestamp: new Date().toLocaleString(t.lang === 'es' ? "es-ES" : "zh-CN"),
          total: tx.total,
          items: tx.cart.map(item => ({ 
            name: t.lang === 'es' ? item.name_es || item.name : item.name, 
            quantity: item.quantity, 
            price: item.price 
          })),
          discount: tx.discount,
          paymentMethod: method,
          customerName: tx.customerName,
          customerPhone: tx.customerPhone,
          customerTaxNumber: tx.customerTaxNumber || ''
        }));
        // Save tickets to localStorage for tickets.html
        const savedTickets = JSON.parse(localStorage.getItem("tickets") || "[]");
        localStorage.setItem("tickets", JSON.stringify([...savedTickets, ...tickets]));
        onConfirm(method, tickets);
        onClose();
      };

      if (!isOpen) return null;

      return (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
          <div className="bg-white rounded-lg p-6 w-1/3">
            <h2 className="text-xl font-bold mb-4">{t.selectPayment}</h2>
            {selectedTransactions && (
              <p className="mb-4">{t.totalAmount}: €{totalAmount.toFixed(2)}</p>
            )}
            <div className="flex flex-col space-y-2 mb-4">
              <button
                onClick={() => handlePayment("card")}
                className="p-3 rounded text-lg bg-gray-200 hover:bg-gray-300"
              >
                {t.card}
              </button>
              <button
                onClick={() => handlePayment("cash")}
                className="p-3 rounded text-lg bg-gray-200 hover:bg-gray-300"
              >
                {t.cash}
              </button>
            </div>
            <button
              onClick={onClose}
              className="bg-gray-500 text-white p-2 rounded w-full hover:bg-gray-600"
            >
              {t.close}
            </button>
            <CashPaymentModal
              isOpen={isCashModalOpen}
              onClose={() => {
                setIsCashModalOpen(false);
                onClose();
              }}
              onConfirm={onConfirm}
              transaction={selectedTransactions ? { total: totalAmount } : transaction}
              selectedTransactions={selectedTransactions}
              t={t}
            />
          </div>
        </div>
      );
    }

    // Search Panel Component
    function SearchPanel({ isOpen, onClose, onSearch, t }) {
      const [searchCriteria, setSearchCriteria] = React.useState({
        customerName: '',
        date: '',
        amount: ''
      });

      const handleInputChange = (e) => {
        const { name, value } = e.target;
        setSearchCriteria((prev) => ({ ...prev, [name]: value }));
      };

      const handleSearch = () => {
        onSearch(searchCriteria);
        onClose();
      };

      const handleCancel = () => {
        setSearchCriteria({ customerName: '', date: '', amount: '' });
        onClose();
      };

      return (
        <div
          className={`fixed top-0 right-0 h-full bg-white shadow-lg z-50 transform transition-transform duration-300 ease-in-out ${
            isOpen ? 'translate-x-0' : 'translate-x-full'
          } w-80 p-6`}
        >
          <h3 className="text-lg font-bold mb-4">{t.searchDebt}</h3>
          <div className="mb-4">
            <label className="block text-sm font-medium mb-1">{t.customerName}</label>
            <input
              type="text"
              name="customerName"
              value={searchCriteria.customerName}
              onChange={handleInputChange}
              className="w-full p-2 border rounded"
              placeholder={t.searchCustomerPlaceholder}
            />
          </div>
          <div className="mb-4">
            <label className="block text-sm font-medium mb-1">{t.date}</label>
            <input
              type="date"
              name="date"
              value={searchCriteria.date}
              onChange={handleInputChange}
              className="w-full p-2 border rounded"
              placeholder={t.searchDatePlaceholder}
            />
          </div>
          <div className="mb-4">
            <label className="block text-sm font-medium mb-1">{t.amount}</label>
            <input
              type="number"
              name="amount"
              value={searchCriteria.amount}
              onChange={handleInputChange}
              className="w-full p-2 border rounded"
              placeholder={t.searchAmountPlaceholder}
              step="0.01"
            />
          </div>
          <div className="flex space-x-2">
            <button
              onClick={handleCancel}
              className="flex-1 bg-gray-500 text-white p-2 rounded hover:bg-gray-600"
            >
              {t.cancel}
            </button>
            <button
              onClick={handleSearch}
              className="flex-1 bg-blue-500 text-white p-2 rounded hover:bg-blue-600"
            >
              {t.search}
            </button>
          </div>
        </div>
      );
    }

    // Main Debt List Component
    function DebtList() {
      const [debts, setDebts] = React.useState([]);
      const [filteredDebts, setFilteredDebts] = React.useState([]);
      const [selectedTransaction, setSelectedTransaction] = React.useState(null);
      const [isDetailsModalOpen, setIsDetailsModalOpen] = React.useState(false);
      const [isSearchPanelOpen, setIsSearchPanelOpen] = React.useState(false);
      const [isSettleModalOpen, setIsSettleModalOpen] = React.useState(false);
      const [isBatchMode, setIsBatchMode] = React.useState(false);
      const [selectedIds, setSelectedIds] = React.useState([]);
      const [language, setLanguage] = React.useState(localStorage.getItem('language') || 'zh');

      // Update document language and title on language change
      React.useEffect(() => {
        document.documentElement.lang = language;
        document.title = translations[language].title;
      }, [language]);

      // Handle language change
      const handleLanguageChange = (lang) => {
        setLanguage(lang);
        localStorage.setItem('language', lang);
      };

      // Function to sort debts by timestamp in descending order
      const sortDebtsByDate = (debts) => {
        return [...debts].sort((a, b) => {
          const dateA = new Date(a.timestamp);
          const dateB = new Date(b.timestamp);
          return dateB - dateA; // Descending order
        });
      };

      // Load debts from localStorage on mount and sort them
      React.useEffect(() => {
        const savedDebts = JSON.parse(localStorage.getItem("debts") || "[]");
        const sortedDebts = sortDebtsByDate(savedDebts);
        setDebts(sortedDebts);
        setFilteredDebts(sortedDebts);
      }, []);

      // Handle viewing transaction details
      const handleViewDetails = (transaction) => {
        setSelectedTransaction(transaction);
        setIsDetailsModalOpen(true);
      };

      // Handle opening settle payment modal
      const handleOpenSettleModal = (transaction) => {
        setSelectedTransaction(transaction);
        setIsSettleModalOpen(true);
      };

      // Handle batch settle
      const handleBatchSettle = () => {
        if (selectedIds.length === 0) {
          alert(translations[language].errorNoSelection);
          return;
        }
        const selectedTransactions = debts.filter(tx => selectedIds.includes(tx.id));
        setSelectedTransaction(selectedTransactions);
        setIsSettleModalOpen(true);
      };

      // Handle settling a transaction
      const handleSettleTransaction = (method, tickets) => {
        const updatedDebts = debts.filter(
          (transaction) => !tickets.some(ticket => ticket.id === transaction.id)
        );
        const sortedDebts = sortDebtsByDate(updatedDebts);
        setDebts(sortedDebts);
        setFilteredDebts(sortedDebts);
        localStorage.setItem("debts", JSON.stringify(sortedDebts));
        setIsSettleModalOpen(false);
        setSelectedTransaction(null);
        setSelectedIds([]);
        setIsBatchMode(false);
      };

      // Handle search
      const handleSearch = (criteria) => {
        const filtered = debts.filter((transaction) => {
          const matchesName = criteria.customerName
            ? transaction.customerName.toLowerCase().includes(criteria.customerName.toLowerCase())
            : true;
          const matchesDate = criteria.date
            ? transaction.timestamp.includes(criteria.date)
            : true;
          const matchesAmount = criteria.amount
            ? Math.abs(transaction.total - parseFloat(criteria.amount)) < 0.01
            : true;
          return matchesName && matchesDate && matchesAmount;
        });
        const sortedFiltered = sortDebtsByDate(filtered);
        setFilteredDebts(sortedFiltered);
      };

      // Handle checkbox toggle
      const handleCheckboxToggle = (id) => {
        setSelectedIds(prev =>
          prev.includes(id) ? prev.filter(x => x !== id) : [...prev, id]
        );
      };

      const t = translations[language];

      return (
        <ErrorBoundary t={t}>
          <div className="flex h-screen">
            {/* Sidebar */}
            <div className="w-16 bg-gray-900 text-white flex flex-col items-center py-4 fixed h-full shadow-lg">
              <h1 className="text-lg font-bold mb-8">{t.pos}</h1>
              <nav className="flex flex-col space-y-4">
                <a
                  href="index.html"
                  className="p-2 rounded-full hover:bg-gray-700"
                  title={t.sales}
                >
                  🛒
                </a>
                <a
                  href="index.html#inventory"
                  className="p-2 rounded-full hover:bg-gray-700"
                  title={t.inventory}
                >
                  📦
                </a>
                <a
                  href="cliente.html"
                  className="p-2 rounded-full hover:bg-gray-700"
                  title={t.membership}
                >
                  👤
                </a>
                <a
                  href="index.html#payments"
                  className="p-2 rounded-full hover:bg-gray-700"
                  title={t.payments}
                >
                  💳
                </a>
                <a
                  href="index.html#reports"
                  className="p-2 rounded-full hover:bg-gray-700"
                  title={t.reports}
                >
                  📊
                </a>
                <a
                  href="index.html#users"
                  className="p-2 rounded-full hover:bg-gray-700"
                  title={t.users}
                >
                  🔒
                </a>
                <a
                  href="tickets.html"
                  className="p-2 rounded-full hover:bg-gray-700"
                  title={t.tickets}
                >
                  🎫
                </a>
                <a
                  href="deuda.html"
                  className="p-2 rounded-full bg-blue-600"
                  title={t.debt}
                >
                  📋
                </a>
              </nav>
            </div>
            {/* Main Content */}
            <div className="ml-16 w-full bg-white p-4">
              <div className="p-6">
                <div className="flex justify-between items-center mb-4">
                  <div className="flex items-center">
                    <h2 className="text-2xl font-bold mr-4">{t.debtList}</h2>
                    <select
                      value={language}
                      onChange={(e) => handleLanguageChange(e.target.value)}
                      className="p-1 rounded bg-gray-200 text-sm"
                    >
                      <option value="es">{t.spanish}</option>
                      <option value="zh">{t.chinese}</option>
                    </select>
                  </div>
                  <div className="flex space-x-2">
                    <button
                      onClick={() => {
                        setIsBatchMode(!isBatchMode);
                        setSelectedIds([]);
                      }}
                      className="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600"
                    >
                      {isBatchMode ? t.cancelBatch : t.batchSettle}
                    </button>
                    <button
                      onClick={() => setIsSearchPanelOpen(true)}
                      className="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600"
                    >
                      {t.search}
                    </button>
                  </div>
                </div>
                {filteredDebts.length === 0 ? (
                  <p className="text-gray-500">{t.noDebts}</p>
                ) : (
                  <>
                    <table className="w-full border-collapse">
                      <thead>
                        <tr className="bg-gray-200">
                          {isBatchMode && (
                            <th className="border p-3 text-left">{t.select}</th>
                          )}
                          <th className="border p-3 text-left">{t.customerName}</th>
                          <th className="border p-3 text-left">{t.phone}</th>
                          <th className="border p-3 text-left">{t.taxId}</th>
                          <th className="border p-3 text-left">{t.date}</th>
                          <th className="border p-3 text-left">{t.amount}</th>
                          <th className="border p-3 text-left">{t.actions}</th>
                        </tr>
                      </thead>
                      <tbody>
                        {filteredDebts.map((transaction) => (
                          <tr key={transaction.id}>
                            {isBatchMode && (
                              <td className="border p-3">
                                <input
                                  type="checkbox"
                                  checked={selectedIds.includes(transaction.id)}
                                  onChange={() => handleCheckboxToggle(transaction.id)}
                                />
                              </td>
                            )}
                            <td className="border p-3">{transaction.customerName}</td>
                            <td className="border p-3">{transaction.customerPhone}</td>
                            <td className="border p-3">{transaction.customerTaxNumber || t.defaultTaxId}</td>
                            <td className="border p-3">{transaction.timestamp}</td>
                            <td className="border p-3">€{transaction.total.toFixed(2)}</td>
                            <td className="border p-3">
                              <button
                                onClick={() => handleViewDetails(transaction)}
                                className="bg-blue-500 text-white px-3 py-1 rounded mr-2 hover:bg-blue-600"
                              >
                                {t.details}
                              </button>
                              <button
                                onClick={() => handleOpenSettleModal(transaction)}
                                className="bg-green-500 text-white px-3 py-1 rounded hover:bg-green-600"
                              >
                                {t.settle}
                              </button>
                            </td>
                          </tr>
                        ))}
                      </tbody>
                    </table>
                    {isBatchMode && (
                      <div className="mt-4">
                        <button
                          onClick={handleBatchSettle}
                          className="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700"
                        >
                          {t.confirm}
                        </button>
                      </div>
                    )}
                  </>
                )}
                <DebtDetailsModal
                  isOpen={isDetailsModalOpen}
                  onClose={() => setIsDetailsModalOpen(false)}
                  transaction={selectedTransaction}
                  t={t}
                />
                <SettlePaymentModal
                  isOpen={isSettleModalOpen}
                  onClose={() => {
                    setIsSettleModalOpen(false);
                    setSelectedTransaction(null);
                  }}
                  onConfirm={handleSettleTransaction}
                  transaction={selectedTransaction}
                  selectedTransactions={Array.isArray(selectedTransaction) ? selectedTransaction : null}
                  t={t}
                />
                <SearchPanel
                  isOpen={isSearchPanelOpen}
                  onClose={() => setIsSearchPanelOpen(false)}
                  onSearch={handleSearch}
                  t={t}
                />
              </div>
            </div>
          </div>
        </ErrorBoundary>
      );
    }

    // Render the app using createRoot
    const rootElement = document.getElementById("root");
    const root = ReactDOM.createRoot(rootElement);
    root.render(<DebtList />);
  </script>
</body>
</html>